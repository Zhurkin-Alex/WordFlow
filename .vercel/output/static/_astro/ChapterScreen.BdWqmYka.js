import{d as a,y as f}from"./hooks.module.BHax5pmd.js";import{g as v,s as S}from"./storage.dyqxtIRL.js";import{u as t}from"./jsxRuntime.module.BXRLK4zq.js";import"./preact.module.BkxX9n6Y.js";const D=({word:s,onClose:r})=>{const[h,k]=a(""),[p,d]=a(!1),g=async()=>{d(!0);try{const m=await(await fetch(`https://api.mymemory.translated.net/get?q=${s}&langpair=en|ru`)).json();k(m.responseData.translatedText)}catch(o){console.error("Translation error:",o)}d(!1)},u=()=>{const o=new SpeechSynthesisUtterance(s);o.lang="en-US",window.speechSynthesis.speak(o)},c=()=>{const o=v();o.knownWords[s]={learned:!1,shownTimes:(o.knownWords[s]?.shownTimes||0)+1},S(o),r()};return t("div",{class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:t("div",{class:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[t("h2",{class:"text-2xl font-bold mb-4",children:s}),t("div",{class:"space-y-4",children:[t("button",{onClick:g,class:"w-full bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded",disabled:p,children:p?"Translating...":"Translate"}),h&&t("div",{class:"p-3 bg-gray-100 rounded",children:t("p",{class:"text-gray-800",children:h})}),t("button",{onClick:u,class:"w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded",children:"Pronounce"}),t("button",{onClick:c,class:"w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 px-4 rounded",children:"Add to Vocabulary"}),t("button",{onClick:r,class:"w-full bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded",children:"Close"})]})]})})},L=({chapter:s})=>{const[r,h]=a(0),[k,p]=a([]),[d,g]=a(null),[u,c]=a(""),[o,m]=a(!1),[w,T]=a([]),i=s.scenes[r];if(!s?.scenes)return t("div",{class:"text-white p-6",children:"‚ö†Ô∏è Scene not found"});f(()=>{const e=v(),n=Object.keys(e.knownWords||{});p(n)},[]),f(()=>{const e=()=>{const n=window.speechSynthesis.getVoices();T(n)};return e(),window.speechSynthesis.onvoiceschanged=e,()=>{window.speechSynthesis.onvoiceschanged=null}},[]),f(()=>{const e=window.document.getElementById("bg-music");if(e){const n=e.volume,l=.5,x=600,b=20;let y=0;const $=(n-l)/b,C=()=>{y<b?(e.volume=Math.max(l,n-$*y),y++,setTimeout(C,x/b)):e.volume=l};C()}},[]);const W=e=>{g(e)},I=()=>{if(c(""),r+1<s.scenes.length)h(r+1);else{const e=v();e.currentChapter=s.id+1,e.currentScene=0,e.completedChapters=[...new Set([...e.completedChapters||[],s.id])],S(e),window.location.href=`/chapter/${e.currentChapter}`}},j=()=>{if(i?.text){const e=new window.SpeechSynthesisUtterance(i.text);let n=w.find(l=>l.lang.startsWith("en")&&l.name.includes("Google"))||w.find(l=>l.lang.startsWith("en"))||w[0];n&&(e.voice=n,e.lang=n.lang),window.speechSynthesis.cancel(),window.speechSynthesis.speak(e)}},V=async()=>{if(i?.text){m(!0),c("");try{const n=await(await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(i.text)}&langpair=en|ru`)).json();c(n.responseData.translatedText)}catch{c("–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞")}m(!1)}};return t("div",{class:"min-h-screen bg-cover bg-center text-white px-4 py-8 flex flex-col justify-center items-center",style:{backgroundImage:`url('${s.image||"/images/cupboard-scene.jpg"}')`},children:[t("div",{class:"max-w-xl text-center text-xl bg-black/40 p-6 rounded-lg backdrop-blur-md flex flex-wrap",children:i.text.split(" ").map((e,n)=>{const l=e.replace(/[.,!?]/g,""),x=i.words.includes(l);return t("span",{class:`mx-1 ${x?"cursor-pointer underline decoration-yellow-400 hover:text-yellow-300":""}`,onClick:()=>x&&W(l),children:e},n)})}),t("div",{class:"flex gap-4 mt-6",children:[t("button",{class:"flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-5 rounded-xl shadow transition-all text-lg",onClick:j,children:[t("span",{role:"img","aria-label":"Read",children:"üîä"})," Read"]}),t("button",{class:"flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-5 rounded-xl shadow transition-all text-lg disabled:opacity-60",onClick:V,disabled:o,children:[t("span",{role:"img","aria-label":"Translate",children:"üåê"})," Translate",o&&t("svg",{class:"animate-spin ml-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v8z"})]})]})]}),u&&t("div",{class:"max-w-xl text-center text-lg bg-emerald-100/80 text-emerald-900 mt-6 p-4 rounded-xl shadow border border-emerald-200",children:u}),t("button",{class:"mt-10 bg-yellow-500 hover:bg-yellow-600 text-black font-semibold py-2 px-6 rounded-xl transition-all",onClick:I,children:r+1<s.scenes.length?"–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å":"–°–ª–µ–¥—É—é—â–∞—è –≥–ª–∞–≤–∞"}),d&&t(D,{word:d,onClose:()=>g(null)})]})};export{L as default};
